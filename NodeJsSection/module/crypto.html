<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
	<meta http-equiv="Content-Type" content="text/html" charset="utf-8" />
	<title>NodeJs-fs</title>
	<meta name="author" content="Leon" />
	<meta name="description" content="The page describes the usage of 'fs' module in NodeJs." />
	<link rel="stylesheet" type="text/css" href="../../js/bootstrap/css/bootstrap.min.css">
	<style type="text/css">
		body,xmp{padding: 0px;margin: 0px;}
		.panel-body{font-size: 15px;}
		.panel-body dt{width: 200px;text-align: right;margin-right: 20px;}
		.title{color: rgba(50,160,180,1);font-size: 16px;}
		span[title]{font-size: 18px;margin-bottom: 5px;display:inline-block;line-height: 20px;}
		pre{overflow-x:hidden; }
		section{margin-bottom: 20px;}
		section:after{content: "------------------------------------------------------------------------------";color: lightblue;}
		textarea{width: 80%;min-height: 300px;}
	</style>
</head>
<body>
	<ol class="breadcrumb">
		<li><a href="#">NodeJs</a></li>
		<li><a href="#">module</a></li>
		<li class="active">cryptoæ¨¡å—</li>
	</ol>
	<h1><strong>CRYPTO åŠ å¯†</strong></h1>
	<div class="panel panel-info">
		<div class="panel-heading">è¯´æ˜:</div>
		<div class="panel-body">
			<pre>const crypto=require('crypto');</pre>
			<p>cryptoæ¨¡å—åŒ…å«äº†ä¸€ç³»åˆ—åŸºäºOpenSSLåº“å°è£…å¥½çš„åŠ å¯†å‡½æ•°ï¼ŒåŒ…æ‹¬<code>hash,HMAC,cipher,decipher,sign and verify</code>ã€‚ä½ éœ€è¦åœ¨ç¼–è¯‘ Node çš„æ—¶å€™æŒ‡å®šæ·»åŠ  OpenSSL æ”¯æŒï¼Œæ‰èƒ½ä½¿ç”¨æœ¬èŠ‚ä»‹ç»çš„æ–¹æ³•ã€‚åŠ å¯†æ¨¡å—èƒ½ä½¿ Node èƒ½å¤Ÿä½¿ç”¨ SSL/TLSã€‚</p>
		</div>
		<div class="panel-footer">
		</div>
	</div>
	<div class="panel panel-info">
		<div class="panel-heading">
			cryptoæ¨¡å—çš„æ ‡å‡†æ–¹æ³•
		</div>
		<div class="panel-body">
			<section>
				<span class="label label-info" title>Hashing å“ˆå¸ŒåŠ å¯†</span>
				<p>Hashç±»æ˜¯ä¸€ä¸ªåˆ›å»ºæ•°æ®çš„å“ˆå¸Œæ‘˜è¦çš„å®ç”¨åº“ï¼Œå®ƒæœ‰ä¸¤ç§ä½¿ç”¨æ–¹æ³•ï¼š</p>
				<ul>
					<li>ä½œä¸ºä¸€ä¸ªå¯è¯»å¯å†™çš„æ•°æ®æµï¼Œæ•°æ®è¢«è¯»å…¥ç„¶åäº§ç”Ÿä¸€ä¸ªè®¡ç®—åçš„å“ˆå¸Œæ‘˜è¦ã€‚</li>
					<li>ä½¿ç”¨<code>hash.update()</code>å’Œ<code>hash.digest()</code>æ–¹æ³•æ¥äº§ç”Ÿå“ˆå¸Œæ‘˜è¦ã€‚</li>
				</ul>
				<p>å“ˆå¸Œå¸¸ç”¨äºå‡ ä¸ªé‡è¦çš„åŠŸèƒ½ï¼Œæ¯”å¦‚æŠŠæ•°æ®æ··æ·†ä»¥ä¾¿äºéªŒè¯ï¼Œæˆ–æ˜¯ä¸ºä¸€ä¸ªè¾ƒå¤§ çš„æ•°æ®æä¾›å¾ˆå°çš„æ ¡éªŒã€‚è¦åœ¨ Node é‡Œä½¿ç”¨å“ˆå¸Œï¼Œéœ€è¦è°ƒç”¨å·¥å‚æ–¹æ³• crypto. createHash() æ¥åˆ›å»ºä¸€ä¸ª Hash å®ä¾‹ã€‚å®ƒä¼šè¿”å›æŒ‡å®šå“ˆå¸Œç®—æ³•çš„ Hash æ–°å®ä¾‹ï¼Œå¤§ éƒ¨åˆ†æµè¡Œçš„ç®—æ³•éƒ½åŒ…å«åœ¨å†…ï¼Œå…·ä½“æ”¯æŒå“ªç§ç®—æ³•è¦çœ‹ä½ å®‰è£…çš„ OpenSSL çš„ç‰ˆæœ¬ï¼Œå‡  ä¸ªå¸¸è§çš„ç®—æ³•æœ‰ï¼š<code>md5,sha1,sha256,sha512,ripemd160</code>ã€‚</p>
				<p>è¿™äº›ç®—æ³•æœ‰å„è‡ªçš„ä¼˜ç¼ºç‚¹ã€‚æ¯”å¦‚ MD5 åœ¨è®¸å¤šåº”ç”¨é‡Œéƒ½ä¼šç”¨åˆ°ï¼Œä½†å®ƒæœ‰ä¸€äº›å·² çŸ¥çš„ç¼ºé™·ï¼ŒåŒ…æ‹¬ç¢°æ’é—®é¢˜ã€‚æ ¹æ®å®é™…çš„åº”ç”¨éœ€è¦ï¼Œä½ å¯ä»¥é€‰æ‹©å¹¿æ³›ä½¿ç”¨çš„ç®—æ³• ï¼ˆå¦‚ MD5ï¼‰ï¼Œæˆ–è€…æ›´æ–°çš„ SHA1ï¼ˆæ¨èä½¿ç”¨ï¼‰ï¼Œç”šè‡³æ˜¯æ›´å°‘è§ä½†æ›´å¥å£®çš„ç®—æ³•ï¼ˆå¦‚ RIPEMDã€ SHA256 æˆ– SHA512ï¼‰</p>
				<p>ä½œä¸ºæµçš„Hashå¯¹è±¡</p>
				<pre>
const crypto=require('crypto');
const hash=crypto.createHash('sha256');
hash.on('readable',()=>{
	var data=hash.read();
	if(data){
		console.log(data.toString('hex'));
		//è¾“å‡º:4360773826139dd47d95effb8a8549a14e8436dedeed71ed5926c92153944306
	}
});
hash.write("I'm Leon, let us to hash.");
hash.end();
				</pre>
				<p>ä½¿ç”¨Hashå’Œpipedæ•°æ®æµ</p>
				<pre>
const crypto=require('crypto');
const fs=require('fs');
const hash=crypto.createHash('sha256');
const input=fs.createReadStream('../../someJson.txt');
input.pipe(hash).pipe(process.stdout);
//è¾“å‡ºï¼šŞºszï¿½-ï¿½ï¿½ï¿½({';ï¿½Sï¿½ï¿½4Ê•ï¿½vï¿½Yï¿½+		( å¹¶ä¸æ‡‚è¿™äº›æ˜¯ä»€ä¹ˆé¬¼:) )		
				</pre>
				<p>ä½¿ç”¨<code>hash.update()</code>å’Œ<code>hash.digest()</code>æ–¹æ³•æ¥äº§ç”Ÿæ‘˜è¦</p>
				<pre>
const crypto=require('crypto');
const hash=crypto.createHash('sha256');
hash.update('leon');
console.log(hash.digest());		
//è¾“å‡º&lt;Buffer 15 34 cf 2a f7 6e cd 84 b8 03 01 0b 70 02 87 c0 04 46 59 9c 68 e8 d8 1b ef a9 c5 69 f0 3e 64 dd>
				</pre>
				<span class="label label-info" title>update æ›´æ–°æ•°æ®</span>
				<p><code>hash.update(data[,encoding]);</code>ç”¨dataæ•°æ®æ¥æ›´æ–°hashå†…å®¹ï¼Œç¼–ç å¯ä»¥æ˜¯<code>'utf8'</code>,<code>'ascii'</code>æˆ–è€…<code>'binary'</code>ã€‚å¦‚æœä¸æä¾›ç¼–ç æ–¹å¼ï¼Œdataæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåˆ™å¼ºåˆ¶ä»¥<code>'binary'</code>ç¼–ç ã€‚å¦‚æœdataæ˜¯Bufferæ ¼å¼ï¼Œåˆ™å¿½ç•¥ç¼–ç æ–¹å¼ã€‚è¯¥æ–¹æ³•åœ¨æ•°æ®æµä¸­å¯ä»¥è¢«è°ƒç”¨å¤šæ¬¡ï¼Œæ·»åŠ åˆ°å“ˆ å¸Œå¯¹è±¡çš„æ•°æ®åªæ˜¯ç®€å•åœ°è¿½åŠ åˆ°å‰ä¸€æ¬¡ä¼ å…¥çš„æ•°æ®å°¾éƒ¨ï¼Œç›´åˆ°éœ€è¦æŠŠå®ƒè¾“å‡ºä¸ºæ­¢ã€‚åœ¨è°ƒç”¨ hash.digest() ä¹‹åï¼Œå°±ä¸å¯ä»¥å†æ·»åŠ ä»»ä½•è¾“å…¥è¿›å»äº†ã€‚</p>
				<span class="label label-info" title>digest ç”Ÿæˆæ‘˜è¦</span>
				<p><code>hash.digest([encoding]);</code>æ–¹æ³•è®¡ç®—å‡ºæ‰€æœ‰å†…å®¹çš„æ•°æ®æ‘˜è¦ï¼Œç¼–ç å¯ä»¥æ˜¯<code>'hex'</code>,<code>'binary'</code>æˆ–è€…<code>'base64'</code>ã€‚å¦‚æœæä¾›äº†ç¼–ç æ–¹å¼åˆ™è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¦åˆ™è¿”å›<code>Buffer</code>æ•°æ®ã€‚è¯¥æ–¹æ³•åªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡ï¼Œå¤šæ¬¡è°ƒç”¨ä¼šæŠ¥é”™ã€‚</p>
				<pre>
const crypto=require('crypto');
const hash=crypto.createHash('sha256');
hash.update('leon');
console.log(hash.digest('hex'));		
//è¾“å‡ºab70e8a91550f6dd16b51a4e8c6c8f55e4dbe649c7caefa9f6e6f082e152cf6c

hash.update('sage');
//è¾“å‡ºæŠ¥é”™ä¿¡æ¯
TypeError: HashUpdate fail
    at TypeError (native)
    at Hash.update (crypto.js:70:16)
    at Object.<anonymous> (E:\git\Leon\NodeJs\sample\hash.js:16:6)
    at Module._compile (module.js:409:26)
    at Object.Module._extensions..js (module.js:416:10)
    at Module.load (module.js:343:32)
    at Function.Module._load (module.js:300:12)
    at Function.Module.runMain (module.js:441:10)
    at startup (node.js:134:18)
    at node.js:962:3

console.log(hash.digest());	
//è¾“å‡ºæŠ¥é”™ä¿¡æ¯
Error: Not initialized
    at Error (native)
    at Hash.digest (crypto.js:77:23)
    at Object.<anonymous> (E:\git\Leon\NodeJs\sample\hash.js:5:18)
    at Module._compile (module.js:409:26)
    at Object.Module._extensions..js (module.js:416:10)
    at Module.load (module.js:343:32)
    at Function.Module._load (module.js:300:12)
    at Function.Module.runMain (module.js:441:10)
    at startup (node.js:134:18)
    at node.js:962:3
				</pre>	
				<span class="label label-info" title>HMAC</span>
				<p>HMAC ç»“åˆäº†å“ˆå¸Œç®—æ³•å’ŒåŠ å¯†å¯†é’¥ï¼Œæ˜¯ä¸ºäº†é˜»æ­¢å¯¹ç­¾åå®Œæ•´æ€§çš„ä¸€äº›æ¶æ„æ”»å‡»ã€‚è¿™ æ„å‘³ç€ HMAC åŒæ—¶ä½¿ç”¨äº†å“ˆå¸Œç®—æ³•ä»¥åŠä¸€ä¸ªåŠ å¯†å¯†é’¥ã€‚Node æä¾›çš„ HMAC API å’Œ Hash API æ˜¯ä¸€æ ·çš„ã€‚å”¯ä¸€çš„ä¸åŒæ˜¯ï¼Œåˆ›å»º hmac å¯¹è±¡æ—¶éœ€è¦åœ¨ä¼ å…¥å“ˆå¸Œç®—æ³•çš„åŒæ—¶ï¼Œå†ä¼ å…¥ä¸€ä¸ªå¯†é’¥ã€‚</p>
				<p>åˆ›å»º Hmac å¯¹è±¡éœ€è¦çš„å¯†é’¥å¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª PEM ç¼–ç çš„å¯†é’¥ï¼Œä»¥å­—ç¬¦ä¸²çš„æ ¼å¼ä¼ å…¥ã€‚åœ¨å‘½ä»¤è¡Œç”¨ OpenSSL å¯ä»¥è½»æ¾åˆ›å»ºä¸€ä¸ªå¯†é’¥ã€‚</p>
				<img src="../../images/nodeJsSection/pem.png" />
				<p>è¿™ä¸ªä¾‹å­åˆ›å»ºçš„æ˜¯ä¸€ä¸ª PEM æ ¼å¼çš„ RSA å¯†é’¥ï¼Œå¹¶ä¿å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œï¼ˆåœ¨æœ¬ä¾‹ä¸­æ˜¯ key.pemï¼‰ã€‚å¦‚æœæˆ‘ä»¬å¿½ç•¥ -out key.pem å‚æ•°ï¼Œä¹Ÿå¯ä»¥åœ¨ Node ä¸­ä½¿ç”¨ process æ¨¡å—æ¥ç›´æ¥è°ƒç”¨åŒæ ·çš„åŠŸèƒ½ï¼Œåœ¨æ ‡å‡†è¾“å‡º ä¸­å¾—åˆ°ç»“æœï¼Œå¦åˆ™ï¼Œå°±éœ€è¦ä»æ–‡ä»¶ä¸­è¯»å–å¯†é’¥ï¼Œç„¶åå†ç”¨æ¥åˆ›å»º Hmac å¯¹è±¡å¹¶ç”Ÿæˆæ‘˜è¦äº†ã€‚</p>
				<pre>
//ä½¿ç”¨PEMæ ¼å¼çš„RSAå¯†é’¥æ¥åˆ›å»ºHmacæ‘˜è¦
const crypto=require('crypto');
const fs=require('fs');
const pem=fs.readFileSync('key.pem');
const key=pem.toString('ascii');
const hmac=crypto.createHmac('sha256',key);
hmac.update('foo');
console.log(hmac.digest('hex'));
//è¾“å‡º: 4aa9b57812fea1d4070245687dba7283ab59b3ff90a31767e4ff1669c06ba48d
				</pre>
				<p>è¿™ä¸ªä¾‹å­ç”¨åˆ°äº† fs.readFileSync()ï¼Œå› ä¸ºåœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œè¯»å–å¯†é’¥ä¼šæ”¾åœ¨æœåŠ¡å™¨å¯åŠ¨ä»»åŠ¡ä¸­ã€‚</p>
				<p>Hmacç±»æ˜¯ä¸€ä¸ªåˆ›å»ºHMACåŠ å¯†æ‘˜è¦çš„å®ç”¨å·¥å…·åº“ï¼Œå®ƒå¯ä»¥æœ‰ä¸¤ç§ä½¿ç”¨æ–¹å¼ï¼š</p>
				<ul>
					<li>ä½œä¸ºä¸€ä¸ªå¯è¯»å¯å†™çš„æ•°æ®æµï¼Œæ•°æ®è¢«è¯»å…¥ç„¶åäº§ç”Ÿä¸€ä¸ªè®¡ç®—åçš„HMACæ‘˜è¦ã€‚</li>
					<li>ä½¿ç”¨<code>hmac.update()</code>å’Œ<code>hmac.digest()</code>æ–¹æ³•æ¥äº§ç”ŸHMACæ‘˜è¦ã€‚</li>
				</ul>
				<span class="label label-info" title>createHmac() åˆ›å»ºHmacå®ä¾‹</span>
				<p><code>crpto.createHmac()</code>æ¥åˆ›å»ºHmacå®ä¾‹ã€‚</p>
				<p>ä½¿ç”¨Hmacå¯¹è±¡ä½œä¸ºæµ</p>
				<pre>
const crypto=require('crypto');
const hmac=crypto.createHmac('sha256','secret');
hmac.on('readable',()=>{
	var data=hmac.read();
	if(data){
		console.log(data.toString('hex'));
		//è¾“å‡º:a753d7e1c8fbe9f53291fbb3460f7c52ee09367ee475df2e87554719acda7a7a
	}
});
hmac.write("I'm Leon, let us to hash.");
hmac.end();
				</pre>
				<p>ä½¿ç”¨Hmacå’Œpipedæ•°æ®æµ</p>
				<pre>
const crypto=require('crypto');
const fs=require('fs');
const hmac=crypto.createHmac('sha256','secret');
const input=fs.createReadStream('../../someJson.txt');
input.pipe(hmac).pipe(process.stdout);
//è¾“å‡ºï¼š2ï¿½bï¿½ï¿½t;ß¼ï¿½27i\4j"ï¿½-ï¿½ï¿½xï¿½ï¿½Ü‘		( æˆ‘ä¹Ÿä¸æ‡‚è¿™äº›æ˜¯ä»€ä¹ˆé¬¼:) )		
				</pre>
				<p>ä½¿ç”¨<code>hmac.update()</code>å’Œ<code>hmac.digest()</code>æ–¹æ³•æ¥äº§ç”Ÿæ‘˜è¦</p>
				<pre>
const crypto=require('crypto');
const hmac=crypto.createHmac('sha256','secret');
hmac.update('leon');
console.log(hmac.digest('hex'));		
//è¾“å‡ºc2e333e478fa802d853e9d05f3802c68b823a85838410834f39414bd076ca0dd
				</pre>
				<p><code>hash.update(data[,encoding]);</code>å’Œ<code>hash.digest([encoding]);</code>æ–¹æ³•ä¸Hashä¸­ä¸€æ ·ã€‚</p>
				<span class="label label-info" title>å…¬é’¥åŠ å¯†</span>
				<p>å…¬é’¥åŠ å¯†åŠŸèƒ½åˆ†å¸ƒåœ¨å¦‚ä¸‹ 4 ä¸ªç±»ä¸­ï¼šCipherã€Decipherã€Sign å’Œ Verifyã€‚å’ŒåŠ  å¯†æ¨¡å—çš„å…¶ä»–ç±»ä¸€æ ·ï¼Œå®ƒä»¬ä¹Ÿæœ‰å·¥å‚æ–¹æ³•ã€‚Cipher æŠŠæ•°æ®åŠ å¯†ï¼Œ Decipher è§£å¯†æ•°æ®ï¼ŒSign ä¸ºæ•°æ®åˆ›å»ºåŠ å¯†ç­¾åï¼ŒVerify éªŒè¯åŠ å¯†ç­¾åã€‚</p>
				<p>å¯¹ HMAC æ“ä½œï¼Œæˆ‘ä»¬ç”¨åˆ°äº†ç§é’¥ã€‚å¯¹äºæœ¬å°èŠ‚çš„æ“ä½œï¼Œæˆ‘ä»¬å°†åŒæ—¶ä½¿ç”¨å…¬é’¥å’Œç§ é’¥ã€‚å…¬é’¥åŠ å¯†ç®—æ³•éœ€è¦ä¸€ç»„é…å¯¹çš„å¯†é’¥ï¼šä¸€ä¸ªæ˜¯ç§é’¥ï¼Œç”±ç‰©ä¸»ä¿å­˜ï¼Œç”¨æ¥è§£å¯†å’Œå¯¹ æ•°æ®ç­¾åï¼Œå¦å¤–ä¸€ä¸ªæ˜¯å…¬é’¥ï¼Œæä¾›ç»™ç¬¬ä¸‰æ–¹ã€‚å…¬é’¥å¯ä»¥ç”¨æ¥åŠ å¯†æ•°æ®ï¼Œå¹¶ä¸”åªèƒ½è®© ç§é’¥æ‹¥æœ‰è€…è§£è¯»ï¼Œæˆ–è€…ç”¨æ¥éªŒè¯æ•°æ®æ˜¯å¦è¢«å¯¹åº”çš„ç§é’¥æ‰€ç­¾åã€‚</p>
				<p>è®©æˆ‘ä»¬ä»åˆšåˆšç”Ÿæˆæ¥è¿›è¡Œ HMAC æ‘˜è¦çš„ç§é’¥ä¸­æå–å¯¹åº”çš„å…¬é’¥å§ã€‚Node è¦æ±‚å…¬é’¥æŒ‰ç…§è¯ä¹¦æ ¼å¼ï¼Œæ‰€ä»¥éœ€è¦ä½ æä¾›é¢å¤–çš„ä¿¡æ¯ï¼Œä½†ä½ ä¹Ÿå¯ä»¥ä¸å¡«è¿™äº›ä¿¡æ¯ï¼Œ è®©å…¶ç•™ç©ºå°±è¡Œäº†ã€‚</p>
				<pre>
//ä»ç§é’¥ä¸­æå–å…¬é’¥è¯ä¹¦
openssl req -key key.pem -new -x509 -out cert.pem
				</pre>
				<p>æˆ‘ä»¬è®© OpenSSL è¯»å–ç§é’¥ï¼Œç„¶åæŠŠå…¬é’¥ä»¥ X509 è¯ä¹¦æ ¼å¼è¾“å‡ºåˆ° cert.pem æ–‡ä»¶ä¸­ã€‚ åŠ å¯†ç®—æ³•ç”¨åˆ°çš„å¯†é’¥éƒ½è¦æ±‚æ˜¯ PEM æ ¼å¼çš„ã€‚</p>
				<span class="label label-info" title>ç”¨CipheråŠ å¯†</span>
				<p><code>crypto.createCipher('algorithm','secret')</code>æˆ–è€…<code>crypto.createCipheriv()</code>æ–¹æ³•è¾“å…¥ä¸€ä¸ªç®—æ³•å’Œç§é’¥åˆ›å»ºä¸€ä¸ªCipherå®ä¾‹ï¼Œæ”¯æŒçš„ç®—æ³•ä»ä½ å®‰è£…çš„OpenSSLå®ç°ä¸­æ”¯æŒçš„ï¼š<code>blowfish</code>æˆ–è€…<code>aes192</code>ã€‚è®¸å¤šç°ä»£çš„åŠ å¯†ç®—æ³•ä½¿ç”¨å—å¯†ç ï¼Œä¹Ÿå°±æ˜¯è¾“å‡ºçš„é€šå¸¸æ˜¯æ ‡å‡†å¤§å°çš„â€œå—â€ã€‚å—å¤§å°ä¸ ä½¿ç”¨çš„ç®—æ³•æœ‰å…³ï¼Œå¦‚ blowfish ä½¿ç”¨çš„æ˜¯ 40 å­—èŠ‚çš„å—ã€‚è¿™å½“ä½ ä½¿ç”¨ Cipher API æ—¶ ä¼šæ˜æ˜¾çœ‹å‡ºï¼Œå› ä¸º API æ€»æ˜¯ä½¿ç”¨å›ºå®šå¤§å°çš„å—ã€‚è¿™ç§åšæ³•èƒ½å¤Ÿé˜²æ­¢ä¿¡æ¯æ³„éœ²ç»™æ”»å‡»è€…ï¼Œå¦‚åŠ å¯†çš„ä¿¡æ¯æˆ–è€…æ˜¯ç”¨æ¥åŠ å¯†çš„ç‰¹å®šå¯†é’¥ã€‚</p>
				<p>å®ä¾‹ç”¨æ¥åŠ å¯†æ•°æ®ï¼Œè¿™ä¸ªç±»å¯ä»¥ä½¿ç”¨ä¸¤ç§æ–¹å¼ï¼š</p>
				<ul>
					<li>ä½œä¸ºä¸€ä¸ªå¯å†™å¯è¯»çš„æµï¼Œè¯»å…¥æœªåŠ å¯†çš„æ–‡æœ¬è¾“å‡ºåŠ å¯†çš„æ•°æ®ã€‚</li>
					<li>ä½¿ç”¨<code>cipher.update()</code>å’Œ<code>cipher.final()</code>æ–¹æ³•æ¥åŠ å¯†æ•°æ®</li>
				</ul>
				<p>ä½¿ç”¨Cipherå¯¹è±¡ä½œä¸ºæµ</p>
				<pre>
const crypto=require('crypto');
const cipher=crypto.createCipher('aes192','password');
var encrypted='';
cipher.on('readable',()=>{
	var data=cipher.read();
	if(data){
		encrypted+=data.toString('hex');		
	}
});
cipher.on('end',()=>{
	console.log(encrypted);
	//è¾“å‡º:d23291d24de95b0c8f45d55596a080da161e3ab39de38ca5789c9a29c149e18c
})
cipher.write("some clear text data.");
cipher.end();
				</pre>
				<p>ä½¿ç”¨Cipherå’Œpipedæ•°æ®æµ</p>
				<pre>
const crypto=require('crypto');
const fs=require('fs');
const cipher=crypto.createCipher('aes192','password');
const input=fs.createReadStream('../../someJson.txt');
input.pipe(cipher).pipe(process.stdout);
//è¾“å‡ºï¼šï¿½ï¿½H%ï¿½ï¿½ï¿½vï¿½ï¿½ ï¿½Pï¿½ï¿½ï¿½@ï¿½3\ï¿½Ş§ï¿½ï¿½ï¿½ï¿½ï¿½
ï¿½ï¿½ï¿½ï¿½Jï¿½ï¿½ï¿½ï¿½ï¿½#j2ï¿½ï¿½R]ï¿½ï¿½ï¿½ï¿½Fï¿½vï¿½oï¿½ï¿½Ybï¿½Oï¿½Ü³  'ï¿½l
EOï¿½E%; bï¿½Gï¿½ï¿½ï¿½Ô¥Æ‰ï¿½#   ^3ï¿½ï¿½tï¿½ï¿½ï¿½       ï¿½ï¿½4ï¿½k1ï¿½/uï¿½ï¿½#ï¿½3ï¿½ï¿½fï¿½oï¿½_6ï¿½Ê¬ï¿½Lİ†ï¿½ï¿½dï¿½ï¿½jï¿½Æ€ï¿½ï¿½4N9wï¿½ï¿½Yt'Fï¿½ï¿½ï¿½mlï¿½RUï¿½ï¿½qï¿½ï¿½ï¿½Ú°Gï¿½e^U8Ì•ï¿½ì€™ï¿½ï¿½-kï¿½   %ï¿½ï¿½Fï¿½ï¿½ï¿½Cyeï¿½ï¿½ï¿½ï¿½[ï¿½ÂªCï¿½@ÂŒÄ•)ï¿½ï¿½Fï¿½ï¿½ï¿½Lï¿½S;ï¿½ï¿½ï¿½^ï¿½zï¿½.ï¿½ï¿½yï¿½ï¿½"3Òœï¿½		
				</pre>
				<p>ä½¿ç”¨<code>cipher.update()</code>å’Œ<code>cipher.final()</code>æ–¹æ³•æ¥äº§ç”Ÿæ‘˜è¦</p>
				<pre>
const crypto=require('crypto');
const cipher=crypto.createCipher('aes192','password');
var encrypted=cipher.update('some clear text data','utf8','hex');
encrypted+=cipher.final('hex');
console.log(encrypted);		
//è¾“å‡ºd23291d24de95b0c8f45d55596a080dac609924387c7b1802fb79a4365a7ebe9
				</pre>
				<span class="label label-info" title>update æ›´æ–°è¾“å…¥æ•°æ®</span>
				<p><code>cipher.update(data[,input_encoding][,output_encoding]);</code>ä½¿ç”¨dataæ›´æ–°cipherï¼Œè¾“å…¥ç¼–ç æ–¹å¼æœ‰<code>'utf8'</code>,<code>'ascii'</code>æˆ–è€…<code>'binary'</code>ï¼Œè¿™æ—¶dataæ•°æ®åº”è¯¥è¢«æŒ‡å®šçš„æ ¼å¼ç¼–ç ã€‚å½“dataæ˜¯Bufferï¼Œåˆ™<code>input_encoding</code>è¢«å¿½ç•¥ã€‚</p>
				<p>è¾“å‡ºç¼–ç æ ¼å¼æ˜¯åŠ å¯†åæ•°æ®çš„æ ¼å¼ï¼Œå¯ä»¥ä¸º<code>'hex'</code>,<code>'binary'</code>æˆ–è€…<code>'base64'</code>ã€‚å¦‚æœæŒ‡å®š<code>output_encoding</code>ï¼Œåˆ™è¿”å›æŒ‡å®šæ ¼å¼çš„åŠ å¯†æ•°æ®ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œåˆ™è¿”å›Bufferã€‚</p>
				<p><code>cipher.update()</code>å¯ä»¥åœ¨<code>cipher.final()</code>ä¹‹å‰è°ƒç”¨å¾ˆå¤šæ¬¡ï¼Œä¹‹ååˆ™ä¼šæŠ¥é”™ã€‚</p>
				<span class="label label-info" title>final è¾“å‡ºåŠ å¯†æ•°æ® </span>
				<p><code>cipher.final([output_encoding]);</code>è¿”å›æ‰€æœ‰çš„åŠ å¯†æ•°æ®ï¼ŒåŒæ—¶æ·»åŠ è¶³å¤Ÿçš„å¡«å……ä½¿å…¶æ»¡è¶³å—å¤§å°æ ¼å¼ã€‚<code>output_encoding</code>å‚æ•°å¯ä»¥ä¸º<code>'hex'</code>,<code>'binary'</code>æˆ–è€…<code>'base64'</code>ã€‚å¦‚æœä¸æŒ‡å®šï¼Œåˆ™è¿”å›Bufferã€‚</p>
				<p><code>cipher.final()</code>æ–¹æ³•åªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡ï¼Œå¤šæ¬¡è°ƒç”¨ä¼šæŠ›å‡ºé”™è¯¯ã€‚</p>
				<span class="label label-info" title>setAutoPadding è‡ªåŠ¨å¡«å…… </span>
				<p><code>cipher.setAutoPadding(auto_padding=true);</code>å½“ä½¿ç”¨å—åŠ å¯†ç®—æ³•æ—¶ï¼ŒCipherè‡ªåŠ¨å¡«å……è¾“å…¥æ•°æ®åˆ°åˆé€‚çš„å—å¤§å°ï¼Œå–æ¶ˆè‡ªåŠ¨å¡«å……ä¸º<code>cipher.setAutoPadding(false);</code>ä½†å½“ä¸ºå—å¤§å°çš„éå€æ•°æ—¶ï¼ŒæŠ›å‡ºé”™è¯¯ã€‚è¯¥æ–¹æ³•å¿…é¡»åœ¨final()å‰è¾ˆè°ƒç”¨ã€‚</p>
				<span class="label label-info" title>ç”¨Decipherè§£å¯†</span>
				<p><code>crypto.createDecipher('algorithm','secret')</code>æˆ–è€…<code>crypto.createCipheriv()</code>æ–¹æ³•å‡ ä¹å°±æ˜¯Cipherç±»çš„åé¢ã€‚</p>
				<pre>
const crypto=require('crypto');
const fs=require('fs');
var pem=fs.readFileSync('key.pem');
var key=pem.toString('ascii');
var plain='data textarea';

var encrypted="";
var cipher=crypto.createCipher('blowfish',key);
encrypted+=cipher.update(new Buffer(plain),'binary','hex');
encrypted+=cipher.final('hex');

var decrypted="";
var decipher=crypto.createDecipher('blowfish',key);
decrypted+=decipher.update(encrypted,'hex','binary');
decrypted+=decipher.final('binary');

console.log(plain);		//è¾“å‡ºdata textarea
console.log(decrypted);		//è¾“å‡ºdata textarea
				</pre>
				<span class="label label-info" title>ç”¨Signæ¥åˆ›å»ºç­¾å</span>
				<p><code>crypto.createDecipher('algorithm','secret')</code>æˆ–è€…<code>crypto.createCipheriv()</code>æ–¹æ³•å‡ ä¹å°±æ˜¯Cipherç±»çš„åé¢ã€‚</p>
				<pre>
const crypto=require('crypto');
const fs=require('fs');
var pem=fs.readFileSync('key.pem');
var key=pem.toString('ascii');
var plain='data textarea';

var encrypted="";
var cipher=crypto.createCipher('blowfish',key);
encrypted+=cipher.update(new Buffer(plain),'binary','hex');
encrypted+=cipher.final('hex');

var decrypted="";
var decipher=crypto.createDecipher('blowfish',key);
decrypted+=decipher.update(encrypted,'hex','binary');
decrypted+=decipher.final('binary');

console.log(plain);		//è¾“å‡ºdata textarea
console.log(decrypted);		//è¾“å‡ºdata textarea
				</pre>
				<code><cite>http://nodejs.cn/api/crypto.html#crypto_class_cipher</cite></code>

				<pre>
//è°ƒç”¨dns.resolve()

				</pre>
				<p>è¿”å›çš„ç»“æœå°±æ˜¯é€šè¿‡DNSæœåŠ¡å™¨æŸ¥è¯¢å‡ºçš„IPåœ°å€ï¼Œåˆ—è¡¨ä¸­çš„æ¯ä¸€ä¸ªå€¼éƒ½å¯ä»¥è®¿é—®åˆ°ç›¸åŒçš„ç½‘ç«™ã€‚</p>
				<p>è¿˜æœ‰äº›æ–¹ä¾¿çš„æ–¹æ³•å¯ç”¨æ¥å¤„ç†å‰é¢åˆ—å‡ºçš„å„ç§è®°å½•ç±»å‹ã€‚æ¯”å¦‚ï¼Œé™¤äº†è°ƒç”¨ resolve ('example.com', 'MX', callback) ä»¥å¤–ï¼Œä½ è¿˜å¯ä»¥è°ƒç”¨ resolveMx('example. com', callback)ã€‚API è¿˜æä¾›äº† resolve4() å’Œ resolve6() æ–¹æ³•ï¼Œ åˆ†åˆ«ç”¨æ¥è§£æ IPv4 å’Œ IPv6 åœ°å€ã€‚</p>
				<pre>
var dns=require('dns');
dns.resolveMx('yahoo.com',function(e,r){
	if(e){
		console.log(e);
	}
	console.log(r);		
	//è¾“å‡º(åº”è¯¥æ˜¯è·¯ç”±è·¯å¾„ï¼Ÿ)
	[ { exchange: 'mta5.am0.yahoodns.net', priority: 1 },
	  { exchange: 'mta6.am0.yahoodns.net', priority: 1 },
	  { exchange: 'mta7.am0.yahoodns.net', priority: 1 } ]
})
dns.resolveTxt('yahoo.com',function(e,r){
	if(e){
		console.log(e);
	}
	console.log(r);		//è¾“å‡º[ [ 'v=spf1 redirect=_spf.mail.yahoo.com' ] ]
})
				</pre>
				<span class="label label-info" title>lookup æŸ¥è¯¢è·¯å¾„</span>
				<p><code>dns.lookup(hostname[,options],callback)</code>æ–¹æ³•å°†ä¸»æœºåè§£æå‡ºç¬¬ä¸€ä¸ªæ‰¾åˆ°çš„IPv4æˆ–è€…IPv6åœ°å€è®°å½•å¦‚æœä½ æ²¡æœ‰ä¼ å…¥åœ°å€ï¼Œå®ƒä¼šé»˜ è®¤æ˜¯ç½‘ç»œè®¾å¤‡æ¥å£çš„å½“å‰è®¾ç½®ã€‚ã€‚å…¶ä¸­<code>options</code>å¯èƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–è€…æ•´æ•°ï¼Œå¦‚æœæŒ‡å®š4æˆ–è€…6ï¼Œåˆ™åªä¼šè¿”å›ç›¸åº”çš„IPåœ°å€ï¼Œå¦‚æœä¸è®¾ç½®ï¼Œåˆ™IPv4å’ŒIPv6éƒ½å¯ä»¥ã€‚<code>options</code>ä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«çš„å±æ€§(æ‰€æœ‰çš„å‡ä¸ºå¯é€‰é¡¹)æœ‰ï¼š
				<pre>
{
	family:4,
	//å¯é€‰4||6||ç©ºï¼Œä¸è®¾ç½®æ—¶ï¼ŒIPv4å’ŒIPv6éƒ½å¯ä»¥ã€‚

	hints:dns.ADDRCONFIG | dns.V4MAPPED,
	//dns.ADDRCONFIG åªè¿”å›å½“å‰ç³»ç»Ÿæ”¯æŒçš„åœ°å€ç±»å‹ï¼Œä¸åŒ…æ‹¬æœ¬åœ°ç¯å›åœ°å€
	//dns.V4MAPPED å½“å®šä¹‰è¿”å›IPv6ä½†æŸ¥è¯¢ä¸ºç©ºæ—¶ï¼Œè¿”å›æ˜ å°„å¾—åˆ°çš„IPv4åœ°å€

	all:false
	//å½“ä¸ºtrueæ—¶ï¼Œè¿”å›æ‰€æœ‰è§£æåœ°å€ï¼Œé»˜è®¤ä¸ºfalseï¼Œè¿”å›ä¸€ä¸ªå•ä¸€åœ°å€
}
				</pre>
				<code>callback(err,address,family)</code>å›è°ƒå‡½æ•°ä¸­ï¼Œaddressä¸ºè¿”å›çš„åœ°å€æ•°ç»„ï¼Œfamilyä¸ºlookupæ—¶è®¾ç½®çš„æ–¹å¼(4||6)ã€‚å½“è®¾ç½®ä¸º<code>all:true</code>æ—¶ï¼Œå›è°ƒå‡½æ•°ä¹Ÿå˜æˆ<code>callback(err,addresses)</code>ã€‚
				</p>
				<pre>
//lookupæŸ¥è¯¢å•ä¸ªè®°å½•
dns.lookup('yahoo.com',4,function(e,a){
	console.log(a);		//è¾“å‡º98.139.183.24
})
				</pre>
				<span class="label label-info" title>reverse </span>
				<p><code>dns.reverse(ip,callback)</code>æ‰§è¡Œä¸€ä¸ªDNSæŸ¥è¯¢å¹¶ä¸”è§£æIPåœ°å€åˆ°ä¸€ä¸ªä¸»æœºåæ•°ç»„ã€‚<code>callback(err,hostnames)</code>,è¿”å›å€¼ä¸ºä¸€ç»„ç»™å®šçš„ipã€‚</p>
				<pre>
dns.resolve('yahoo.com','A',(e,a)=>{
	console.log(a);		//è¾“å‡º[ '98.139.183.24', '206.190.36.45', '98.138.253.109' ]
	for(i in a){
		dns.reverse(a[i],function(e,host){
			console.log(host);
			//è¾“å‡º
				[ 'ir2.fp.vip.bf1.yahoo.com' ]
				[ 'ir1.fp.vip.ne1.yahoo.com' ]
				[ 'ir1.fp.vip.gq1.yahoo.com' ]
		});
	}
})

dns.resolve('google.com','A',(e,a)=>{
	console.log(a);		//è¾“å‡º[ '216.58.197.110' ]
	for(i in a){
		dns.reverse(a[i],function(e,host){
			console.log(host);
			//è¾“å‡º[ 'hkg12s01-in-f14.1e100.net' ]
		});
	}
})
				</pre>
				<p><code>(err,data)=>{...}</code>ä¸€æ ·å¯ä»¥ä½œä¸ºå›è°ƒå‡½æ•°çš„è¡¨è¾¾æ–¹å¼ã€‚åœ¨ä¾‹å­ä¸­å¾—åˆ°çš„åŸŸåéƒ½æ˜¯å¯è¾¾çš„ï¼Œä¸è¿‡æ˜¯æˆ‘ä»¬è¾“å…¥åŸŸåçš„å…·ä½“ä¸»æœºåã€‚</p>
				<cite>å‚è€ƒèµ„æ–™ï¼š<code>http://nodejs.cn/api/dns.html#dns_dns_resolve_hostname_rrtype_callback</code></cite>
			</section>
		</div>
	</div>
<script src="../../js/jQuery/jquery-1.11.3.min.js"></script>
<script src="../../js/bootstrap/js/bootstrap.min.js"></script>
<script>
	$(function(){
		var data={
			num:110,
			name:'ä¸½ä¸½',
			"åœ°å€":"èƒŒæ™¯"
		}
		console.log(data);
		for(var i in data){
			console.log(data[i]);
		}
		console.log(data['åœ°å€']);
	});
</script>
</body>
</html>